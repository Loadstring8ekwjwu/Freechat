<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Debugger</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body style="font-family:sans-serif; text-align:center; padding:20px;">

    <h2>نظام فحص الاتصال</h2>
    <div id="status" style="padding:10px; background:#eee; margin-bottom:10px;">الحالة: جاري التحميل...</div>
    
    <input type="email" id="email" placeholder="الإيميل" style="display:block; width:100%; margin:10px 0; padding:10px;">
    <input type="password" id="password" placeholder="الباسورد" style="display:block; width:100%; margin:10px 0; padding:10px;">
    
    <button onclick="startCheck()" style="width:100%; padding:15px; background:blue; color:white; border:none; border-radius:5px;">اضغط هنا للبدء</button>

    <div id="log-box" style="margin-top:20px; text-align:left; background:black; color:lime; padding:15px; height:200px; overflow:auto; font-family:monospace; font-size:12px;">
        --Logs Started--
    </div>

    <script>
        const logBox = document.getElementById('log-box');
        const statusDiv = document.getElementById('status');

        function addLog(text, color = "lime") {
            logBox.innerHTML += `<div style="color:${color}">> ${text}</div>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // التأكد من أن المكتبة تم تحميلها
        window.onload = () => {
            if (typeof supabase === 'undefined') {
                addLog("خطأ: لم يتم تحميل مكتبة Supabase! تأكد من اتصال الإنترنت.", "red");
                statusDiv.innerText = "فشل تحميل المكتبة";
            } else {
                addLog("المكتبة جاهزة للعمل.");
                statusDiv.innerText = "جاهز للاختبار";
            }
        };

        async function startCheck() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            addLog("بدء عملية الفحص...");

            const URL = 'https://xrvkkhuukqxvuwscgcvh.supabase.co';
            const KEY = 'sb_publishable_FWznB9cBJHwv_yK0A3F79g_w7cCyNv-';

            try {
                const client = supabase.createClient(URL, KEY);
                addLog("تم إنشاء العميل (Client) بنجاح.");

                addLog("محاولة تسجيل الدخول...");
                const { data, error } = await client.auth.signInWithPassword({ email, password });

                if (error) {
                    addLog("فشل الدخول: " + error.message, "yellow");
                    addLog("جاري محاولة إنشاء حساب جديد...");
                    const { error: sError } = await client.auth.signUp({ email, password });
                    
                    if (sError) {
                        addLog("فشل التسجيل أيضاً: " + sError.message, "red");
                        alert("الخطأ هو: " + sError.message);
                    } else {
                        addLog("تم إنشاء الحساب! افحص إيميلك أو جرب الدخول مرة أخرى.");
                        alert("تم التسجيل بنجاح!");
                    }
                } else {
                    addLog("تم تسجيل الدخول بنجاح!!!", "cyan");
                    alert("مبروك! دخلت الحساب.");
                }
            } catch (e) {
                addLog("خطأ برمجي: " + e.message, "red");
            }
        }
    </script>
</body>
</html>
